<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Welcome to GeeMail</title>
    <script src="js/mail-generator.js"></script>
    <script src="js/feather.min.js"></script>
    <script src="js/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet" media="screen">
    <link rel="icon" type="image/png" href="files/favicon.png">
    <script>
      window.onload = function() {
        var inboxCount = document.querySelector('#inbox-count');
        var mainBody = document.querySelector('#main-body');

        // Sort array of old emails in chronological order:
        geemails.sort(function(a, b) {
          return a.date.getTime() > b.date.getTime();
        });

        function constructDisplayedEmail(id, index) {
          var displayedEmail = document.createElement('div');
          displayedEmail.id = id;
          displayedEmail.innerHTML =
              '<div class="email-header">' +
              '<div class="email-header-top"><div class="email-sender">' +
              geemails[index].sender +
              '</div><div class="email-date">' +
              moment(geemails[index].date).format('MMM. DD, YYYY') +
              '</div></div><div class="email-header-bottom"><div class="email-subject">' +
              geemails[index].subject +
              '</div><div class="trash">' +
              '<i class="feather-trash" data-feather="trash-2"></i>' +
              '</div></div></div><div class="email-body email-body-hidden">' +
              geemails[index].body +
              '</div>';
          return displayedEmail;
        }

        // Load old emails and create ID system for use in deletion:
        for (var i = 0; i < geemails.length; i++) {
          geemails[i]._id = i;
          oldEmail = constructDisplayedEmail(i, i);
          oldEmail.className = 'email';
          mainBody.insertBefore(oldEmail, mainBody.childNodes[0]);
        }

        inboxCount.textContent = geemails.length;

        // Ensure ID numbers for new emails are sequenced appropriately:
        var _id = geemails.length;

        // Create function to open/close email by clicking email header:
        function addOpenClose(email) {
          email.children[0].addEventListener('mouseup', function() {
            this.classList.add('read-email');
            this.classList.toggle('open-email');
            this.parentNode.children[1].classList.toggle('email-body-hidden');
          });
        }

        // Create function to delete email by clicking trash icon:
        function addDelete(email) {
          email.children[0].children[1].children[1].addEventListener(
            'mouseup',
            function(event) {
              event.stopPropagation();
              removeArrayElement(email);
              email.classList.add('fade-email');
              setTimeout(function() {
                email.remove();
              }, 350);
              setTimeout(function() {
                inboxCount.textContent = geemails.length;
              }, 250);
            }
          );
        }

        // Create function to remove array element that matches deleted DOM element:
        function removeArrayElement(email) {
          for (var i = 0; i < geemails.length; i++) {
            if (geemails[i]._id === Number(email.id)) {
              geemails.splice(i, 1);
            }
          }
        }

        // Add ability to open/close/delete old emails:
        var emails = document.querySelectorAll('.email');
        emails.forEach(function(email) {
          addOpenClose(email);
          addDelete(email);
        });

        function pushNewMessageToGeemails() {
          var newMessage = getNewMessage();
          newMessage._id = _id;
          geemails.push(newMessage);
        }

        // Display new email (with open/close/delete options) in inbox at set interval:
        window.setInterval(function() {
          pushNewMessageToGeemails();
          var lastIndex = geemails.length - 1;
          var newEmail = constructDisplayedEmail(_id, lastIndex);
          newEmail.className = 'email email-incoming';          
          mainBody.insertBefore(newEmail, mainBody.childNodes[0]);
          _id++;
          setTimeout(function() {
            newEmail.classList.remove('email-incoming');
          }, 50);
          setTimeout(function() {
            addOpenClose(newEmail);
            addDelete(newEmail);
          }, 250);
          inboxCount.textContent = geemails.length;
          feather.replace();
          moment().format();
        }, 7777); // All Lucky 7s! ðŸŽ°
        
        feather.replace();
        moment().format();
      };
    </script>
  </head>
  <body>
    <div id="content">
      <div id="header">
        <div id="header-container">
          <div id="logo">
            <div><i class="feather-mail" data-feather="mail"></i></div>
            <div>GeeMail</div>
          </div>
          <div id="greeting">
            <div>Welcome,</div>
            <div id="name">DevLeague!</div>
          </div>
        </div>
      </div>
      <div id="subheader">
        <div id="subheader-container">
          <div id="inbox">
            <div id="inbox-title">Inbox</div>
            <div id="inbox-total">Total (<span id="inbox-count"></span>)</div>
          </div>
        </div>
      </div>
      <div id="main">
        <div id="main-container">
          <div id="main-body"></div>
        </div>
      </div>
    </div>
    <div id="footer">
      <div id="footer-container">
        Â© 2018 GeeMail. All Rights Reserved.
      </div>
    </div>
  </body>
</html>
<!-- ðŸ‘‹ -->